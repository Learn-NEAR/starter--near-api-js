/**
 * Minified by jsDelivr using Terser v5.14.1.
 * Original file: /npm/@near-wallet-selector/core@5.0.3/index.umd.js
 *
 * Do NOT use SRI with dynamically generated files! More information: https://www.jsdelivr.com/using-sri-with-dynamic-files
 */
 !function(t,e){"object"==typeof exports&&"undefined"!=typeof module?e(exports,require("near-api-js"),require("rxjs")):"function"==typeof define&&define.amd?define(["exports","near-api-js","rxjs"],e):e((t="undefined"!=typeof globalThis?globalThis:t||self).Core={},t.nearApiJs,t.rxjs)}(this,(function(t,e,n){"use strict";
 /*! *****************************************************************************
		 Copyright (c) Microsoft Corporation.
 
		 Permission to use, copy, modify, and/or distribute this software for any
		 purpose with or without fee is hereby granted.
 
		 THE SOFTWARE IS PROVIDED "AS IS" AND THE AUTHOR DISCLAIMS ALL WARRANTIES WITH
		 REGARD TO THIS SOFTWARE INCLUDING ALL IMPLIED WARRANTIES OF MERCHANTABILITY
		 AND FITNESS. IN NO EVENT SHALL THE AUTHOR BE LIABLE FOR ANY SPECIAL, DIRECT,
		 INDIRECT, OR CONSEQUENTIAL DAMAGES OR ANY DAMAGES WHATSOEVER RESULTING FROM
		 LOSS OF USE, DATA OR PROFITS, WHETHER IN AN ACTION OF CONTRACT, NEGLIGENCE OR
		 OTHER TORTIOUS ACTION, ARISING OUT OF OR IN CONNECTION WITH THE USE OR
		 PERFORMANCE OF THIS SOFTWARE.
		 ***************************************************************************** */function r(t,e,n,r){return new(n||(n=Promise))((function(o,i){function s(t){try{a(r.next(t))}catch(t){i(t)}}function c(t){try{a(r.throw(t))}catch(t){i(t)}}function a(t){var e;t.done?o(t.value):(e=t.value,e instanceof n?e:new n((function(t){t(e)}))).then(s,c)}a((r=r.apply(t,e||[])).next())}))}class o{constructor(t){this.provider=new e.providers.JsonRpcProvider({url:t})}query(t){return this.provider.query(t)}viewAccessKey({accountId:t,publicKey:e}){return this.query({request_type:"view_access_key",finality:"final",account_id:t,public_key:e})}block(t){return this.provider.block(t)}sendTransaction(t){return this.provider.sendTransaction(t)}}class i{constructor(t,e){this.storage=t,this.namespace=Array.isArray(e)?e.join(":"):e}resolveKey(t){return[this.namespace,t].join(":")}getItem(t){return this.storage.getItem(this.resolveKey(t)).then((t=>"string"==typeof t?JSON.parse(t):null))}setItem(t,e){return this.storage.setItem(this.resolveKey(t),JSON.stringify(e))}removeItem(t){return this.storage.removeItem(this.resolveKey(t))}}var s="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},c=function(t){return t&&t.Math==Math&&t},a=c("object"==typeof globalThis&&globalThis)||c("object"==typeof window&&window)||c("object"==typeof self&&self)||c("object"==typeof s&&s)||function(){return this}()||Function("return this")(),u={},l=function(t){try{return!!t()}catch(t){return!0}},f=!l((function(){return 7!=Object.defineProperty({},1,{get:function(){return 7}})[1]})),d=!l((function(){var t=function(){}.bind();return"function"!=typeof t||t.hasOwnProperty("prototype")})),p=d,h=Function.prototype.call,v=p?h.bind(h):function(){return h.apply(h,arguments)},y={},g={}.propertyIsEnumerable,m=Object.getOwnPropertyDescriptor,b=m&&!g.call({1:2},1);y.f=b?function(t){var e=m(this,t);return!!e&&e.enumerable}:g;var w,O,j=function(t,e){return{enumerable:!(1&t),configurable:!(2&t),writable:!(4&t),value:e}},S=d,I=Function.prototype,E=I.bind,L=I.call,T=S&&E.bind(L,L),_=S?function(t){return t&&T(t)}:function(t){return t&&function(){return L.apply(t,arguments)}},x=_,P=x({}.toString),A=x("".slice),C=function(t){return A(P(t),8,-1)},W=_,k=l,N=C,M=a.Object,R=W("".split),F=k((function(){return!M("z").propertyIsEnumerable(0)}))?function(t){return"String"==N(t)?R(t,""):M(t)}:M,D=a.TypeError,U=function(t){if(null==t)throw D("Can't call method on "+t);return t},G=F,V=U,q=function(t){return G(V(t))},K=function(t){return"function"==typeof t},B=K,z=function(t){return"object"==typeof t?null!==t:B(t)},H=a,$=K,J=function(t){return $(t)?t:void 0},Y=function(t,e){return arguments.length<2?J(H[t]):H[t]&&H[t][e]},X=_({}.isPrototypeOf),Q=Y("navigator","userAgent")||"",Z=a,tt=Q,et=Z.process,nt=Z.Deno,rt=et&&et.versions||nt&&nt.version,ot=rt&&rt.v8;ot&&(O=(w=ot.split("."))[0]>0&&w[0]<4?1:+(w[0]+w[1])),!O&&tt&&(!(w=tt.match(/Edge\/(\d+)/))||w[1]>=74)&&(w=tt.match(/Chrome\/(\d+)/))&&(O=+w[1]);var it=O,st=it,ct=l,at=!!Object.getOwnPropertySymbols&&!ct((function(){var t=Symbol();return!String(t)||!(Object(t)instanceof Symbol)||!Symbol.sham&&st&&st<41})),ut=at&&!Symbol.sham&&"symbol"==typeof Symbol.iterator,lt=Y,ft=K,dt=X,pt=ut,ht=a.Object,vt=pt?function(t){return"symbol"==typeof t}:function(t){var e=lt("Symbol");return ft(e)&&dt(e.prototype,ht(t))},yt=a.String,gt=function(t){try{return yt(t)}catch(t){return"Object"}},mt=K,bt=gt,wt=a.TypeError,Ot=function(t){if(mt(t))return t;throw wt(bt(t)+" is not a function")},jt=Ot,St=function(t,e){var n=t[e];return null==n?void 0:jt(n)},It=v,Et=K,Lt=z,Tt=a.TypeError,_t={exports:{}},xt=a,Pt=Object.defineProperty,At=function(t,e){try{Pt(xt,t,{value:e,configurable:!0,writable:!0})}catch(n){xt[t]=e}return e},Ct=At,Wt="__core-js_shared__",kt=a[Wt]||Ct(Wt,{}),Nt=kt;(_t.exports=function(t,e){return Nt[t]||(Nt[t]=void 0!==e?e:{})})("versions",[]).push({version:"3.21.1",mode:"global",copyright:"Â© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.21.1/LICENSE",source:"https://github.com/zloirock/core-js"});var Mt=U,Rt=a.Object,Ft=function(t){return Rt(Mt(t))},Dt=Ft,Ut=_({}.hasOwnProperty),Gt=Object.hasOwn||function(t,e){return Ut(Dt(t),e)},Vt=_,qt=0,Kt=Math.random(),Bt=Vt(1..toString),zt=function(t){return"Symbol("+(void 0===t?"":t)+")_"+Bt(++qt+Kt,36)},Ht=a,$t=_t.exports,Jt=Gt,Yt=zt,Xt=at,Qt=ut,Zt=$t("wks"),te=Ht.Symbol,ee=te&&te.for,ne=Qt?te:te&&te.withoutSetter||Yt,re=function(t){if(!Jt(Zt,t)||!Xt&&"string"!=typeof Zt[t]){var e="Symbol."+t;Xt&&Jt(te,t)?Zt[t]=te[t]:Zt[t]=Qt&&ee?ee(e):ne(e)}return Zt[t]},oe=v,ie=z,se=vt,ce=St,ae=function(t,e){var n,r;if("string"===e&&Et(n=t.toString)&&!Lt(r=It(n,t)))return r;if(Et(n=t.valueOf)&&!Lt(r=It(n,t)))return r;if("string"!==e&&Et(n=t.toString)&&!Lt(r=It(n,t)))return r;throw Tt("Can't convert object to primitive value")},ue=re,le=a.TypeError,fe=ue("toPrimitive"),de=function(t,e){if(!ie(t)||se(t))return t;var n,r=ce(t,fe);if(r){if(void 0===e&&(e="default"),n=oe(r,t,e),!ie(n)||se(n))return n;throw le("Can't convert object to primitive value")}return void 0===e&&(e="number"),ae(t,e)},pe=vt,he=function(t){var e=de(t,"string");return pe(e)?e:e+""},ve=z,ye=a.document,ge=ve(ye)&&ve(ye.createElement),me=function(t){return ge?ye.createElement(t):{}},be=me,we=!f&&!l((function(){return 7!=Object.defineProperty(be("div"),"a",{get:function(){return 7}}).a})),Oe=f,je=v,Se=y,Ie=j,Ee=q,Le=he,Te=Gt,_e=we,xe=Object.getOwnPropertyDescriptor;u.f=Oe?xe:function(t,e){if(t=Ee(t),e=Le(e),_e)try{return xe(t,e)}catch(t){}if(Te(t,e))return Ie(!je(Se.f,t,e),t[e])};var Pe={},Ae=f&&l((function(){return 42!=Object.defineProperty((function(){}),"prototype",{value:42,writable:!1}).prototype})),Ce=a,We=z,ke=Ce.String,Ne=Ce.TypeError,Me=function(t){if(We(t))return t;throw Ne(ke(t)+" is not an object")},Re=f,Fe=we,De=Ae,Ue=Me,Ge=he,Ve=a.TypeError,qe=Object.defineProperty,Ke=Object.getOwnPropertyDescriptor,Be="enumerable",ze="configurable",He="writable";Pe.f=Re?De?function(t,e,n){if(Ue(t),e=Ge(e),Ue(n),"function"==typeof t&&"prototype"===e&&"value"in n&&He in n&&!n.writable){var r=Ke(t,e);r&&r.writable&&(t[e]=n.value,n={configurable:ze in n?n.configurable:r.configurable,enumerable:Be in n?n.enumerable:r.enumerable,writable:!1})}return qe(t,e,n)}:qe:function(t,e,n){if(Ue(t),e=Ge(e),Ue(n),Fe)try{return qe(t,e,n)}catch(t){}if("get"in n||"set"in n)throw Ve("Accessors not supported");return"value"in n&&(t[e]=n.value),t};var $e=Pe,Je=j,Ye=f?function(t,e,n){return $e.f(t,e,Je(1,n))}:function(t,e,n){return t[e]=n,t},Xe={exports:{}},Qe=K,Ze=kt,tn=_(Function.toString);Qe(Ze.inspectSource)||(Ze.inspectSource=function(t){return tn(t)});var en,nn,rn,on=Ze.inspectSource,sn=K,cn=on,an=a.WeakMap,un=sn(an)&&/native code/.test(cn(an)),ln=_t.exports,fn=zt,dn=ln("keys"),pn=function(t){return dn[t]||(dn[t]=fn(t))},hn={},vn=un,yn=a,gn=_,mn=z,bn=Ye,wn=Gt,On=kt,jn=pn,Sn=hn,In="Object already initialized",En=yn.TypeError,Ln=yn.WeakMap;if(vn||On.state){var Tn=On.state||(On.state=new Ln),_n=gn(Tn.get),xn=gn(Tn.has),Pn=gn(Tn.set);en=function(t,e){if(xn(Tn,t))throw new En(In);return e.facade=t,Pn(Tn,t,e),e},nn=function(t){return _n(Tn,t)||{}},rn=function(t){return xn(Tn,t)}}else{var An=jn("state");Sn[An]=!0,en=function(t,e){if(wn(t,An))throw new En(In);return e.facade=t,bn(t,An,e),e},nn=function(t){return wn(t,An)?t[An]:{}},rn=function(t){return wn(t,An)}}var Cn={set:en,get:nn,has:rn,enforce:function(t){return rn(t)?nn(t):en(t,{})},getterFor:function(t){return function(e){var n;if(!mn(e)||(n=nn(e)).type!==t)throw En("Incompatible receiver, "+t+" required");return n}}},Wn=f,kn=Gt,Nn=Function.prototype,Mn=Wn&&Object.getOwnPropertyDescriptor,Rn=kn(Nn,"name"),Fn={EXISTS:Rn,PROPER:Rn&&"something"===function(){}.name,CONFIGURABLE:Rn&&(!Wn||Wn&&Mn(Nn,"name").configurable)},Dn=a,Un=K,Gn=Gt,Vn=Ye,qn=At,Kn=on,Bn=Fn.CONFIGURABLE,zn=Cn.get,Hn=Cn.enforce,$n=String(String).split("String");(Xe.exports=function(t,e,n,r){var o,i=!!r&&!!r.unsafe,s=!!r&&!!r.enumerable,c=!!r&&!!r.noTargetGet,a=r&&void 0!==r.name?r.name:e;Un(n)&&("Symbol("===String(a).slice(0,7)&&(a="["+String(a).replace(/^Symbol\(([^)]*)\)/,"$1")+"]"),(!Gn(n,"name")||Bn&&n.name!==a)&&Vn(n,"name",a),(o=Hn(n)).source||(o.source=$n.join("string"==typeof a?a:""))),t!==Dn?(i?!c&&t[e]&&(s=!0):delete t[e],s?t[e]=n:Vn(t,e,n)):s?t[e]=n:qn(e,n)})(Function.prototype,"toString",(function(){return Un(this)&&zn(this).source||Kn(this)}));var Jn={},Yn=Math.ceil,Xn=Math.floor,Qn=function(t){var e=+t;return e!=e||0===e?0:(e>0?Xn:Yn)(e)},Zn=Qn,tr=Math.max,er=Math.min,nr=Qn,rr=Math.min,or=function(t){return t>0?rr(nr(t),9007199254740991):0},ir=function(t){return or(t.length)},sr=q,cr=function(t,e){var n=Zn(t);return n<0?tr(n+e,0):er(n,e)},ar=ir,ur=function(t){return function(e,n,r){var o,i=sr(e),s=ar(i),c=cr(r,s);if(t&&n!=n){for(;s>c;)if((o=i[c++])!=o)return!0}else for(;s>c;c++)if((t||c in i)&&i[c]===n)return t||c||0;return!t&&-1}},lr={includes:ur(!0),indexOf:ur(!1)},fr=Gt,dr=q,pr=lr.indexOf,hr=hn,vr=_([].push),yr=function(t,e){var n,r=dr(t),o=0,i=[];for(n in r)!fr(hr,n)&&fr(r,n)&&vr(i,n);for(;e.length>o;)fr(r,n=e[o++])&&(~pr(i,n)||vr(i,n));return i},gr=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],mr=yr,br=gr.concat("length","prototype");Jn.f=Object.getOwnPropertyNames||function(t){return mr(t,br)};var wr={};wr.f=Object.getOwnPropertySymbols;var Or=Y,jr=Jn,Sr=wr,Ir=Me,Er=_([].concat),Lr=Or("Reflect","ownKeys")||function(t){var e=jr.f(Ir(t)),n=Sr.f;return n?Er(e,n(t)):e},Tr=Gt,_r=Lr,xr=u,Pr=Pe,Ar=l,Cr=K,Wr=/#|\.prototype\./,kr=function(t,e){var n=Mr[Nr(t)];return n==Fr||n!=Rr&&(Cr(e)?Ar(e):!!e)},Nr=kr.normalize=function(t){return String(t).replace(Wr,".").toLowerCase()},Mr=kr.data={},Rr=kr.NATIVE="N",Fr=kr.POLYFILL="P",Dr=kr,Ur=a,Gr=u.f,Vr=Ye,qr=Xe.exports,Kr=At,Br=function(t,e,n){for(var r=_r(e),o=Pr.f,i=xr.f,s=0;s<r.length;s++){var c=r[s];Tr(t,c)||n&&Tr(n,c)||o(t,c,i(e,c))}},zr=Dr,Hr=function(t,e){var n,r,o,i,s,c=t.target,a=t.global,u=t.stat;if(n=a?Ur:u?Ur[c]||Kr(c,{}):(Ur[c]||{}).prototype)for(r in e){if(i=e[r],o=t.noTargetGet?(s=Gr(n,r))&&s.value:n[r],!zr(a?r:c+(u?".":"#")+r,t.forced)&&void 0!==o){if(typeof i==typeof o)continue;Br(i,o)}(t.sham||o&&o.sham)&&Vr(i,"sham",!0),qr(n,r,i,t)}},$r=a.Promise,Jr=Xe.exports,Yr=a,Xr=K,Qr=Yr.String,Zr=Yr.TypeError,to=_,eo=Me,no=function(t){if("object"==typeof t||Xr(t))return t;throw Zr("Can't set "+Qr(t)+" as a prototype")},ro=Object.setPrototypeOf||("__proto__"in{}?function(){var t,e=!1,n={};try{(t=to(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),e=n instanceof Array}catch(t){}return function(n,r){return eo(n),no(r),e?t(n,r):n.__proto__=r,n}}():void 0),oo=Pe.f,io=Gt,so=re("toStringTag"),co=function(t,e,n){t&&!n&&(t=t.prototype),t&&!io(t,so)&&oo(t,so,{configurable:!0,value:e})},ao=Y,uo=Pe,lo=f,fo=re("species"),po=X,ho=a.TypeError,vo=Ot,yo=d,go=_(_.bind),mo=function(t,e){return vo(t),void 0===e?t:yo?go(t,e):function(){return t.apply(e,arguments)}},bo={},wo=bo,Oo=re("iterator"),jo=Array.prototype,So={};So[re("toStringTag")]="z";var Io=a,Eo="[object z]"===String(So),Lo=K,To=C,_o=re("toStringTag"),xo=Io.Object,Po="Arguments"==To(function(){return arguments}()),Ao=Eo?To:function(t){var e,n,r;return void 0===t?"Undefined":null===t?"Null":"string"==typeof(n=function(t,e){try{return t[e]}catch(t){}}(e=xo(t),_o))?n:Po?To(e):"Object"==(r=To(e))&&Lo(e.callee)?"Arguments":r},Co=Ao,Wo=St,ko=bo,No=re("iterator"),Mo=function(t){if(null!=t)return Wo(t,No)||Wo(t,"@@iterator")||ko[Co(t)]},Ro=v,Fo=Ot,Do=Me,Uo=gt,Go=Mo,Vo=a.TypeError,qo=v,Ko=Me,Bo=St,zo=mo,Ho=v,$o=Me,Jo=gt,Yo=function(t){return void 0!==t&&(wo.Array===t||jo[Oo]===t)},Xo=ir,Qo=X,Zo=function(t,e){var n=arguments.length<2?Go(t):e;if(Fo(n))return Do(Ro(n,t));throw Vo(Uo(t)+" is not iterable")},ti=Mo,ei=function(t,e,n){var r,o;Ko(t);try{if(!(r=Bo(t,"return"))){if("throw"===e)throw n;return n}r=qo(r,t)}catch(t){o=!0,r=t}if("throw"===e)throw n;if(o)throw r;return Ko(r),n},ni=a.TypeError,ri=function(t,e){this.stopped=t,this.result=e},oi=ri.prototype,ii=re("iterator"),si=!1;try{var ci=0,ai={next:function(){return{done:!!ci++}},return:function(){si=!0}};ai[ii]=function(){return this},Array.from(ai,(function(){throw 2}))}catch(t){}var ui=_,li=l,fi=K,di=Ao,pi=on,hi=function(){},vi=[],yi=Y("Reflect","construct"),gi=/^\s*(?:class|function)\b/,mi=ui(gi.exec),bi=!gi.exec(hi),wi=function(t){if(!fi(t))return!1;try{return yi(hi,vi,t),!0}catch(t){return!1}},Oi=function(t){if(!fi(t))return!1;switch(di(t)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return bi||!!mi(gi,pi(t))}catch(t){return!0}};Oi.sham=!0;var ji,Si,Ii,Ei,Li=!yi||li((function(){var t;return wi(wi.call)||!wi(Object)||!wi((function(){t=!0}))||t}))?Oi:wi,Ti=Li,_i=gt,xi=a.TypeError,Pi=Me,Ai=function(t){if(Ti(t))return t;throw xi(_i(t)+" is not a constructor")},Ci=re("species"),Wi=d,ki=Function.prototype,Ni=ki.apply,Mi=ki.call,Ri="object"==typeof Reflect&&Reflect.apply||(Wi?Mi.bind(Ni):function(){return Mi.apply(Ni,arguments)}),Fi=Y("document","documentElement"),Di=_([].slice),Ui=a.TypeError,Gi=/(?:ipad|iphone|ipod).*applewebkit/i.test(Q),Vi="process"==C(a.process),qi=a,Ki=Ri,Bi=mo,zi=K,Hi=Gt,$i=l,Ji=Fi,Yi=Di,Xi=me,Qi=function(t,e){if(t<e)throw Ui("Not enough arguments");return t},Zi=Gi,ts=Vi,es=qi.setImmediate,ns=qi.clearImmediate,rs=qi.process,os=qi.Dispatch,is=qi.Function,ss=qi.MessageChannel,cs=qi.String,as=0,us={},ls="onreadystatechange";try{ji=qi.location}catch(t){}var fs=function(t){if(Hi(us,t)){var e=us[t];delete us[t],e()}},ds=function(t){return function(){fs(t)}},ps=function(t){fs(t.data)},hs=function(t){qi.postMessage(cs(t),ji.protocol+"//"+ji.host)};es&&ns||(es=function(t){Qi(arguments.length,1);var e=zi(t)?t:is(t),n=Yi(arguments,1);return us[++as]=function(){Ki(e,void 0,n)},Si(as),as},ns=function(t){delete us[t]},ts?Si=function(t){rs.nextTick(ds(t))}:os&&os.now?Si=function(t){os.now(ds(t))}:ss&&!Zi?(Ei=(Ii=new ss).port2,Ii.port1.onmessage=ps,Si=Bi(Ei.postMessage,Ei)):qi.addEventListener&&zi(qi.postMessage)&&!qi.importScripts&&ji&&"file:"!==ji.protocol&&!$i(hs)?(Si=hs,qi.addEventListener("message",ps,!1)):Si=ls in Xi("script")?function(t){Ji.appendChild(Xi("script")).onreadystatechange=function(){Ji.removeChild(this),fs(t)}}:function(t){setTimeout(ds(t),0)});var vs,ys,gs,ms,bs,ws,Os,js,Ss={set:es,clear:ns},Is=a,Es=/ipad|iphone|ipod/i.test(Q)&&void 0!==Is.Pebble,Ls=/web0s(?!.*chrome)/i.test(Q),Ts=a,_s=mo,xs=u.f,Ps=Ss.set,As=Gi,Cs=Es,Ws=Ls,ks=Vi,Ns=Ts.MutationObserver||Ts.WebKitMutationObserver,Ms=Ts.document,Rs=Ts.process,Fs=Ts.Promise,Ds=xs(Ts,"queueMicrotask"),Us=Ds&&Ds.value;Us||(vs=function(){var t,e;for(ks&&(t=Rs.domain)&&t.exit();ys;){e=ys.fn,ys=ys.next;try{e()}catch(t){throw ys?ms():gs=void 0,t}}gs=void 0,t&&t.enter()},As||ks||Ws||!Ns||!Ms?!Cs&&Fs&&Fs.resolve?((Os=Fs.resolve(void 0)).constructor=Fs,js=_s(Os.then,Os),ms=function(){js(vs)}):ks?ms=function(){Rs.nextTick(vs)}:(Ps=_s(Ps,Ts),ms=function(){Ps(vs)}):(bs=!0,ws=Ms.createTextNode(""),new Ns(vs).observe(ws,{characterData:!0}),ms=function(){ws.data=bs=!bs}));var Gs=Us||function(t){var e={fn:t,next:void 0};gs&&(gs.next=e),ys||(ys=e,ms()),gs=e},Vs={},qs=Ot,Ks=function(t){var e,n;this.promise=new t((function(t,r){if(void 0!==e||void 0!==n)throw TypeError("Bad Promise constructor");e=t,n=r})),this.resolve=qs(e),this.reject=qs(n)};Vs.f=function(t){return new Ks(t)};var Bs=Me,zs=z,Hs=Vs,$s=a,Js=function(){this.head=null,this.tail=null};Js.prototype={add:function(t){var e={item:t,next:null};this.head?this.tail.next=e:this.head=e,this.tail=e},get:function(){var t=this.head;if(t)return this.head=t.next,this.tail===t&&(this.tail=null),t.item}};var Ys,Xs,Qs,Zs,tc=Js,ec="object"==typeof window,nc=Hr,rc=a,oc=Y,ic=v,sc=$r,cc=Xe.exports,ac=function(t,e,n){for(var r in e)Jr(t,r,e[r],n);return t},uc=ro,lc=co,fc=function(t){var e=ao(t),n=uo.f;lo&&e&&!e[fo]&&n(e,fo,{configurable:!0,get:function(){return this}})},dc=Ot,pc=K,hc=z,vc=function(t,e){if(po(e,t))return t;throw ho("Incorrect invocation")},yc=on,gc=function(t,e,n){var r,o,i,s,c,a,u,l=n&&n.that,f=!(!n||!n.AS_ENTRIES),d=!(!n||!n.IS_ITERATOR),p=!(!n||!n.INTERRUPTED),h=zo(e,l),v=function(t){return r&&ei(r,"normal",t),new ri(!0,t)},y=function(t){return f?($o(t),p?h(t[0],t[1],v):h(t[0],t[1])):p?h(t,v):h(t)};if(d)r=t;else{if(!(o=ti(t)))throw ni(Jo(t)+" is not iterable");if(Yo(o)){for(i=0,s=Xo(t);s>i;i++)if((c=y(t[i]))&&Qo(oi,c))return c;return new ri(!1)}r=Zo(t,o)}for(a=r.next;!(u=Ho(a,r)).done;){try{c=y(u.value)}catch(t){ei(r,"throw",t)}if("object"==typeof c&&c&&Qo(oi,c))return c}return new ri(!1)},mc=function(t,e){if(!e&&!si)return!1;var n=!1;try{var r={};r[ii]=function(){return{next:function(){return{done:n=!0}}}},t(r)}catch(t){}return n},bc=function(t,e){var n,r=Pi(t).constructor;return void 0===r||null==(n=Pi(r)[Ci])?e:Ai(n)},wc=Ss.set,Oc=Gs,jc=function(t,e){if(Bs(t),zs(e)&&e.constructor===t)return e;var n=Hs.f(t);return(0,n.resolve)(e),n.promise},Sc=function(t,e){var n=$s.console;n&&n.error&&(1==arguments.length?n.error(t):n.error(t,e))},Ic=Vs,Ec=function(t){try{return{error:!1,value:t()}}catch(t){return{error:!0,value:t}}},Lc=tc,Tc=Cn,_c=Dr,xc=ec,Pc=Vi,Ac=it,Cc=re("species"),Wc="Promise",kc=Tc.getterFor(Wc),Nc=Tc.set,Mc=Tc.getterFor(Wc),Rc=sc&&sc.prototype,Fc=sc,Dc=Rc,Uc=rc.TypeError,Gc=rc.document,Vc=rc.process,qc=Ic.f,Kc=qc,Bc=!!(Gc&&Gc.createEvent&&rc.dispatchEvent),zc=pc(rc.PromiseRejectionEvent),Hc="unhandledrejection",$c=!1,Jc=_c(Wc,(function(){var t=yc(Fc),e=t!==String(Fc);if(!e&&66===Ac)return!0;if(Ac>=51&&/native code/.test(t))return!1;var n=new Fc((function(t){t(1)})),r=function(t){t((function(){}),(function(){}))};return(n.constructor={})[Cc]=r,!($c=n.then((function(){}))instanceof r)||!e&&xc&&!zc})),Yc=Jc||!mc((function(t){Fc.all(t).catch((function(){}))})),Xc=function(t){var e;return!(!hc(t)||!pc(e=t.then))&&e},Qc=function(t,e){var n,r,o,i=e.value,s=1==e.state,c=s?t.ok:t.fail,a=t.resolve,u=t.reject,l=t.domain;try{c?(s||(2===e.rejection&&ra(e),e.rejection=1),!0===c?n=i:(l&&l.enter(),n=c(i),l&&(l.exit(),o=!0)),n===t.promise?u(Uc("Promise-chain cycle")):(r=Xc(n))?ic(r,n,a,u):a(n)):u(i)}catch(t){l&&!o&&l.exit(),u(t)}},Zc=function(t,e){t.notified||(t.notified=!0,Oc((function(){for(var n,r=t.reactions;n=r.get();)Qc(n,t);t.notified=!1,e&&!t.rejection&&ea(t)})))},ta=function(t,e,n){var r,o;Bc?((r=Gc.createEvent("Event")).promise=e,r.reason=n,r.initEvent(t,!1,!0),rc.dispatchEvent(r)):r={promise:e,reason:n},!zc&&(o=rc["on"+t])?o(r):t===Hc&&Sc("Unhandled promise rejection",n)},ea=function(t){ic(wc,rc,(function(){var e,n=t.facade,r=t.value;if(na(t)&&(e=Ec((function(){Pc?Vc.emit("unhandledRejection",r,n):ta(Hc,n,r)})),t.rejection=Pc||na(t)?2:1,e.error))throw e.value}))},na=function(t){return 1!==t.rejection&&!t.parent},ra=function(t){ic(wc,rc,(function(){var e=t.facade;Pc?Vc.emit("rejectionHandled",e):ta("rejectionhandled",e,t.value)}))},oa=function(t,e,n){return function(r){t(e,r,n)}},ia=function(t,e,n){t.done||(t.done=!0,n&&(t=n),t.value=e,t.state=2,Zc(t,!0))},sa=function(t,e,n){if(!t.done){t.done=!0,n&&(t=n);try{if(t.facade===e)throw Uc("Promise can't be resolved itself");var r=Xc(e);r?Oc((function(){var n={done:!1};try{ic(r,e,oa(sa,n,t),oa(ia,n,t))}catch(e){ia(n,e,t)}})):(t.value=e,t.state=1,Zc(t,!1))}catch(e){ia({done:!1},e,t)}}};if(Jc&&(Dc=(Fc=function(t){vc(this,Dc),dc(t),ic(Ys,this);var e=kc(this);try{t(oa(sa,e),oa(ia,e))}catch(t){ia(e,t)}}).prototype,(Ys=function(t){Nc(this,{type:Wc,done:!1,notified:!1,parent:!1,reactions:new Lc,rejection:!1,state:0,value:void 0})}).prototype=ac(Dc,{then:function(t,e){var n=Mc(this),r=qc(bc(this,Fc));return n.parent=!0,r.ok=!pc(t)||t,r.fail=pc(e)&&e,r.domain=Pc?Vc.domain:void 0,0==n.state?n.reactions.add(r):Oc((function(){Qc(r,n)})),r.promise},catch:function(t){return this.then(void 0,t)}}),Xs=function(){var t=new Ys,e=kc(t);this.promise=t,this.resolve=oa(sa,e),this.reject=oa(ia,e)},Ic.f=qc=function(t){return t===Fc||t===Qs?new Xs(t):Kc(t)},pc(sc)&&Rc!==Object.prototype)){Zs=Rc.then,$c||(cc(Rc,"then",(function(t,e){var n=this;return new Fc((function(t,e){ic(Zs,n,t,e)})).then(t,e)}),{unsafe:!0}),cc(Rc,"catch",Dc.catch,{unsafe:!0}));try{delete Rc.constructor}catch(t){}uc&&uc(Rc,Dc)}nc({global:!0,wrap:!0,forced:Jc},{Promise:Fc}),lc(Fc,Wc,!1),fc(Wc),Qs=oc(Wc),nc({target:Wc,stat:!0,forced:Jc},{reject:function(t){var e=qc(this);return ic(e.reject,void 0,t),e.promise}}),nc({target:Wc,stat:!0,forced:Jc},{resolve:function(t){return jc(this,t)}}),nc({target:Wc,stat:!0,forced:Yc},{all:function(t){var e=this,n=qc(e),r=n.resolve,o=n.reject,i=Ec((function(){var n=dc(e.resolve),i=[],s=0,c=1;gc(t,(function(t){var a=s++,u=!1;c++,ic(n,e,t).then((function(t){u||(u=!0,i[a]=t,--c||r(i))}),o)})),--c||r(i)}));return i.error&&o(i.value),n.promise},race:function(t){var e=this,n=qc(e),r=n.reject,o=Ec((function(){var o=dc(e.resolve);gc(t,(function(t){ic(o,e,t).then(n.resolve,r)}))}));return o.error&&r(o.value),n.promise}});class ca{getItem(t){return new Promise((e=>{e(localStorage.getItem(t))}))}setItem(t,e){return new Promise((n=>{localStorage.setItem(t,e),n()}))}removeItem(t){return new Promise((e=>{localStorage.removeItem(t),e()}))}}var aa={},ua=yr,la=gr,fa=Object.keys||function(t){return ua(t,la)},da=f,pa=Ae,ha=Pe,va=Me,ya=q,ga=fa;aa.f=da&&!pa?Object.defineProperties:function(t,e){va(t);for(var n,r=ya(e),o=ga(e),i=o.length,s=0;i>s;)ha.f(t,n=o[s++],r[n]);return t};var ma,ba=Me,wa=aa,Oa=gr,ja=hn,Sa=Fi,Ia=me,Ea=pn("IE_PROTO"),La=function(){},Ta=function(t){return"<script>"+t+"</"+"script>"},_a=function(t){t.write(Ta("")),t.close();var e=t.parentWindow.Object;return t=null,e},xa=function(){try{ma=new ActiveXObject("htmlfile")}catch(t){}var t,e;xa="undefined"!=typeof document?document.domain&&ma?_a(ma):((e=Ia("iframe")).style.display="none",Sa.appendChild(e),e.src=String("javascript:"),(t=e.contentWindow.document).open(),t.write(Ta("document.F=Object")),t.close(),t.F):_a(ma);for(var n=Oa.length;n--;)delete xa.prototype[Oa[n]];return xa()};ja[Ea]=!0;var Pa=Object.create||function(t,e){var n;return null!==t?(La.prototype=ba(t),n=new La,La.prototype=null,n[Ea]=t):n=xa(),void 0===e?n:wa.f(n,e)},Aa=Pa,Ca=Pe,Wa=re("unscopables"),ka=Array.prototype;null==ka[Wa]&&Ca.f(ka,Wa,{configurable:!0,value:Aa(null)});var Na,Ma,Ra,Fa=!l((function(){function t(){}return t.prototype.constructor=null,Object.getPrototypeOf(new t)!==t.prototype})),Da=a,Ua=Gt,Ga=K,Va=Ft,qa=Fa,Ka=pn("IE_PROTO"),Ba=Da.Object,za=Ba.prototype,Ha=qa?Ba.getPrototypeOf:function(t){var e=Va(t);if(Ua(e,Ka))return e[Ka];var n=e.constructor;return Ga(n)&&e instanceof n?n.prototype:e instanceof Ba?za:null},$a=l,Ja=K,Ya=Ha,Xa=Xe.exports,Qa=re("iterator"),Za=!1;[].keys&&("next"in(Ra=[].keys())?(Ma=Ya(Ya(Ra)))!==Object.prototype&&(Na=Ma):Za=!0);var tu=null==Na||$a((function(){var t={};return Na[Qa].call(t)!==t}));tu&&(Na={}),Ja(Na[Qa])||Xa(Na,Qa,(function(){return this}));var eu={IteratorPrototype:Na,BUGGY_SAFARI_ITERATORS:Za},nu=eu.IteratorPrototype,ru=Pa,ou=j,iu=co,su=bo,cu=function(){return this},au=Hr,uu=v,lu=Fn,fu=K,du=function(t,e,n,r){var o=e+" Iterator";return t.prototype=ru(nu,{next:ou(+!r,n)}),iu(t,o,!1),su[o]=cu,t},pu=Ha,hu=ro,vu=co,yu=Ye,gu=Xe.exports,mu=bo,bu=lu.PROPER,wu=lu.CONFIGURABLE,Ou=eu.IteratorPrototype,ju=eu.BUGGY_SAFARI_ITERATORS,Su=re("iterator"),Iu="keys",Eu="values",Lu="entries",Tu=function(){return this},_u=q,xu=function(t){ka[Wa][t]=!0},Pu=bo,Au=Cn,Cu=Pe.f,Wu=function(t,e,n,r,o,i,s){du(n,e,r);var c,a,u,l=function(t){if(t===o&&v)return v;if(!ju&&t in p)return p[t];switch(t){case Iu:case Eu:case Lu:return function(){return new n(this,t)}}return function(){return new n(this)}},f=e+" Iterator",d=!1,p=t.prototype,h=p[Su]||p["@@iterator"]||o&&p[o],v=!ju&&h||l(o),y="Array"==e&&p.entries||h;if(y&&(c=pu(y.call(new t)))!==Object.prototype&&c.next&&(pu(c)!==Ou&&(hu?hu(c,Ou):fu(c[Su])||gu(c,Su,Tu)),vu(c,f,!0)),bu&&o==Eu&&h&&h.name!==Eu&&(wu?yu(p,"name",Eu):(d=!0,v=function(){return uu(h,this)})),o)if(a={values:l(Eu),keys:i?v:l(Iu),entries:l(Lu)},s)for(u in a)(ju||d||!(u in p))&&gu(p,u,a[u]);else au({target:e,proto:!0,forced:ju||d},a);return p[Su]!==v&&gu(p,Su,v,{name:o}),mu[e]=v,a},ku=f,Nu="Array Iterator",Mu=Au.set,Ru=Au.getterFor(Nu),Fu=Wu(Array,"Array",(function(t,e){Mu(this,{type:Nu,target:_u(t),index:0,kind:e})}),(function(){var t=Ru(this),e=t.target,n=t.kind,r=t.index++;return!e||r>=e.length?(t.target=void 0,{value:void 0,done:!0}):"keys"==n?{value:r,done:!1}:"values"==n?{value:e[r],done:!1}:{value:[r,e[r]],done:!1}}),"values"),Du=Pu.Arguments=Pu.Array;if(xu("keys"),xu("values"),xu("entries"),ku&&"values"!==Du.name)try{Cu(Du,"name",{value:"values"})}catch(t){}var Uu=me("span").classList,Gu=Uu&&Uu.constructor&&Uu.constructor.prototype,Vu=Gu===Object.prototype?void 0:Gu,qu=a,Ku={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Bu=Vu,zu=Fu,Hu=Ye,$u=re,Ju=$u("iterator"),Yu=$u("toStringTag"),Xu=zu.values,Qu=function(t,e){if(t){if(t[Ju]!==Xu)try{Hu(t,Ju,Xu)}catch(e){t[Ju]=Xu}if(t[Yu]||Hu(t,Yu,e),Ku[e])for(var n in zu)if(t[n]!==zu[n])try{Hu(t,n,zu[n])}catch(e){t[n]=zu[n]}}};for(var Zu in Ku)Qu(qu[Zu]&&qu[Zu].prototype,Zu);Qu(Bu,"DOMTokenList");class tl{constructor(t){this.namespace=t}emit(t,...e){tl.debug&&(this.namespace&&"error"!==t?console[t](this.namespace,...e):console[t](...e))}log(...t){this.emit("log",...t)}info(...t){this.emit("info",...t)}warn(...t){this.emit("warn",...t)}error(...t){this.emit("error",...t)}}tl.debug=!1;const el=new tl;var nl=f,rl=_,ol=v,il=l,sl=fa,cl=wr,al=y,ul=Ft,ll=F,fl=Object.assign,dl=Object.defineProperty,pl=rl([].concat),hl=!fl||il((function(){if(nl&&1!==fl({b:1},fl(dl({},"a",{enumerable:!0,get:function(){dl(this,"b",{value:3,enumerable:!1})}}),{b:2})).b)return!0;var t={},e={},n=Symbol(),r="abcdefghijklmnopqrst";return t[n]=7,r.split("").forEach((function(t){e[t]=t})),7!=fl({},t)[n]||sl(fl({},e)).join("")!=r}))?function(t,e){for(var n=ul(t),r=arguments.length,o=1,i=cl.f,s=al.f;r>o;)for(var c,a=ll(arguments[o++]),u=i?pl(sl(a),i(a)):sl(a),l=u.length,f=0;l>f;)c=u[f++],nl&&!ol(s,a,c)||(n[c]=a[c]);return n}:fl,vl=hl;Hr({target:"Object",stat:!0,forced:Object.assign!==vl},{assign:vl});var yl,gl={exports:{}},ml="object"==typeof Reflect?Reflect:null,bl=ml&&"function"==typeof ml.apply?ml.apply:function(t,e,n){return Function.prototype.apply.call(t,e,n)};yl=ml&&"function"==typeof ml.ownKeys?ml.ownKeys:Object.getOwnPropertySymbols?function(t){return Object.getOwnPropertyNames(t).concat(Object.getOwnPropertySymbols(t))}:function(t){return Object.getOwnPropertyNames(t)};var wl=Number.isNaN||function(t){return t!=t};function Ol(){Ol.init.call(this)}gl.exports=Ol,gl.exports.once=function(t,e){return new Promise((function(n,r){function o(n){t.removeListener(e,i),r(n)}function i(){"function"==typeof t.removeListener&&t.removeListener("error",o),n([].slice.call(arguments))}Al(t,e,i,{once:!0}),"error"!==e&&function(t,e,n){"function"==typeof t.on&&Al(t,"error",e,n)}(t,o,{once:!0})}))},Ol.EventEmitter=Ol,Ol.prototype._events=void 0,Ol.prototype._eventsCount=0,Ol.prototype._maxListeners=void 0;var jl=10;function Sl(t){if("function"!=typeof t)throw new TypeError('The "listener" argument must be of type Function. Received type '+typeof t)}function Il(t){return void 0===t._maxListeners?Ol.defaultMaxListeners:t._maxListeners}function El(t,e,n,r){var o,i,s,c;if(Sl(n),void 0===(i=t._events)?(i=t._events=Object.create(null),t._eventsCount=0):(void 0!==i.newListener&&(t.emit("newListener",e,n.listener?n.listener:n),i=t._events),s=i[e]),void 0===s)s=i[e]=n,++t._eventsCount;else if("function"==typeof s?s=i[e]=r?[n,s]:[s,n]:r?s.unshift(n):s.push(n),(o=Il(t))>0&&s.length>o&&!s.warned){s.warned=!0;var a=new Error("Possible EventEmitter memory leak detected. "+s.length+" "+String(e)+" listeners added. Use emitter.setMaxListeners() to increase limit");a.name="MaxListenersExceededWarning",a.emitter=t,a.type=e,a.count=s.length,c=a,console&&console.warn&&console.warn(c)}return t}function Ll(){if(!this.fired)return this.target.removeListener(this.type,this.wrapFn),this.fired=!0,0===arguments.length?this.listener.call(this.target):this.listener.apply(this.target,arguments)}function Tl(t,e,n){var r={fired:!1,wrapFn:void 0,target:t,type:e,listener:n},o=Ll.bind(r);return o.listener=n,r.wrapFn=o,o}function _l(t,e,n){var r=t._events;if(void 0===r)return[];var o=r[e];return void 0===o?[]:"function"==typeof o?n?[o.listener||o]:[o]:n?function(t){for(var e=new Array(t.length),n=0;n<e.length;++n)e[n]=t[n].listener||t[n];return e}(o):Pl(o,o.length)}function xl(t){var e=this._events;if(void 0!==e){var n=e[t];if("function"==typeof n)return 1;if(void 0!==n)return n.length}return 0}function Pl(t,e){for(var n=new Array(e),r=0;r<e;++r)n[r]=t[r];return n}function Al(t,e,n,r){if("function"==typeof t.on)r.once?t.once(e,n):t.on(e,n);else{if("function"!=typeof t.addEventListener)throw new TypeError('The "emitter" argument must be of type EventEmitter. Received type '+typeof t);t.addEventListener(e,(function o(i){r.once&&t.removeEventListener(e,o),n(i)}))}}Object.defineProperty(Ol,"defaultMaxListeners",{enumerable:!0,get:function(){return jl},set:function(t){if("number"!=typeof t||t<0||wl(t))throw new RangeError('The value of "defaultMaxListeners" is out of range. It must be a non-negative number. Received '+t+".");jl=t}}),Ol.init=function(){void 0!==this._events&&this._events!==Object.getPrototypeOf(this)._events||(this._events=Object.create(null),this._eventsCount=0),this._maxListeners=this._maxListeners||void 0},Ol.prototype.setMaxListeners=function(t){if("number"!=typeof t||t<0||wl(t))throw new RangeError('The value of "n" is out of range. It must be a non-negative number. Received '+t+".");return this._maxListeners=t,this},Ol.prototype.getMaxListeners=function(){return Il(this)},Ol.prototype.emit=function(t){for(var e=[],n=1;n<arguments.length;n++)e.push(arguments[n]);var r="error"===t,o=this._events;if(void 0!==o)r=r&&void 0===o.error;else if(!r)return!1;if(r){var i;if(e.length>0&&(i=e[0]),i instanceof Error)throw i;var s=new Error("Unhandled error."+(i?" ("+i.message+")":""));throw s.context=i,s}var c=o[t];if(void 0===c)return!1;if("function"==typeof c)bl(c,this,e);else{var a=c.length,u=Pl(c,a);for(n=0;n<a;++n)bl(u[n],this,e)}return!0},Ol.prototype.addListener=function(t,e){return El(this,t,e,!1)},Ol.prototype.on=Ol.prototype.addListener,Ol.prototype.prependListener=function(t,e){return El(this,t,e,!0)},Ol.prototype.once=function(t,e){return Sl(e),this.on(t,Tl(this,t,e)),this},Ol.prototype.prependOnceListener=function(t,e){return Sl(e),this.prependListener(t,Tl(this,t,e)),this},Ol.prototype.removeListener=function(t,e){var n,r,o,i,s;if(Sl(e),void 0===(r=this._events))return this;if(void 0===(n=r[t]))return this;if(n===e||n.listener===e)0==--this._eventsCount?this._events=Object.create(null):(delete r[t],r.removeListener&&this.emit("removeListener",t,n.listener||e));else if("function"!=typeof n){for(o=-1,i=n.length-1;i>=0;i--)if(n[i]===e||n[i].listener===e){s=n[i].listener,o=i;break}if(o<0)return this;0===o?n.shift():function(t,e){for(;e+1<t.length;e++)t[e]=t[e+1];t.pop()}(n,o),1===n.length&&(r[t]=n[0]),void 0!==r.removeListener&&this.emit("removeListener",t,s||e)}return this},Ol.prototype.off=Ol.prototype.removeListener,Ol.prototype.removeAllListeners=function(t){var e,n,r;if(void 0===(n=this._events))return this;if(void 0===n.removeListener)return 0===arguments.length?(this._events=Object.create(null),this._eventsCount=0):void 0!==n[t]&&(0==--this._eventsCount?this._events=Object.create(null):delete n[t]),this;if(0===arguments.length){var o,i=Object.keys(n);for(r=0;r<i.length;++r)"removeListener"!==(o=i[r])&&this.removeAllListeners(o);return this.removeAllListeners("removeListener"),this._events=Object.create(null),this._eventsCount=0,this}if("function"==typeof(e=n[t]))this.removeListener(t,e);else if(void 0!==e)for(r=e.length-1;r>=0;r--)this.removeListener(t,e[r]);return this},Ol.prototype.listeners=function(t){return _l(this,t,!0)},Ol.prototype.rawListeners=function(t){return _l(this,t,!1)},Ol.listenerCount=function(t,e){return"function"==typeof t.listenerCount?t.listenerCount(e):xl.call(t,e)},Ol.prototype.listenerCount=xl,Ol.prototype.eventNames=function(){return this._eventsCount>0?yl(this._events):[]};class Cl{constructor(){this.emitter=new gl.exports.EventEmitter}on(t,e){return this.emitter.on(t,e),{remove:()=>this.emitter.off(t,e)}}off(t,e){this.emitter.off(t,e)}emit(t,e){this.emitter.emit(t,e)}}const Wl="near-wallet-selector",kl="contract",Nl="contract:pending",Ml="selectedWalletId",Rl="selectedWalletId:pending";class Fl{constructor({factories:t,storage:e,options:n,store:r,emitter:o,provider:i}){this.factories=t,this.storage=e,this.options=n,this.store=r,this.emitter=o,this.provider=i,this.modules=[],this.instances={}}validateWallet(t){return r(this,void 0,void 0,(function*(){let e=[];const n=yield this.getWallet(t);return n&&(e=yield n.getAccounts().catch((t=>(el.log(`Failed to validate ${n.id} during setup`),el.error(t),[])))),e}))}resolveStorageState(){return r(this,void 0,void 0,(function*(){const t=new i(this.storage,Wl),e=yield t.getItem(Rl),n=yield t.getItem(Nl);if(e&&n){const r=yield this.validateWallet(e);if(yield t.removeItem(Rl),yield t.removeItem(Nl),r.length){const{selectedWalletId:t}=this.store.getState(),o=yield this.getWallet(t);return o&&e!==t&&(yield o.signOut().catch((t=>{el.log("Failed to sign out existing wallet"),el.error(t)}))),{accounts:r,contract:n,selectedWalletId:e}}}const{contract:r,selectedWalletId:o}=this.store.getState(),s=yield this.validateWallet(o);return s.length?{accounts:s,contract:r,selectedWalletId:o}:{accounts:[],contract:null,selectedWalletId:null}}))}signOutWallet(t){return r(this,void 0,void 0,(function*(){const e=yield this.getWallet(t);yield e.signOut().catch((t=>{el.log(`Failed to sign out ${e.id}`),el.error(t),this.onWalletSignedOut(e.id)}))}))}onWalletSignedIn(t,{accounts:e,contractId:n,methodNames:o}){return r(this,void 0,void 0,(function*(){const{selectedWalletId:r}=this.store.getState(),s=new i(this.storage,Wl),c={contractId:n,methodNames:o};if(e.length)r&&r!==t&&(yield this.signOutWallet(r)),this.store.dispatch({type:"WALLET_CONNECTED",payload:{walletId:t,contract:c,accounts:e}});else{"browser"===this.getModule(t).type&&(yield s.setItem(Rl,t),yield s.setItem(Nl,c))}}))}onWalletSignedOut(t){this.store.dispatch({type:"WALLET_DISCONNECTED",payload:{walletId:t}})}setupWalletEmitter(t){const e=new Cl;return e.on("signedOut",(()=>{this.onWalletSignedOut(t.id)})),e.on("signedIn",(e=>{this.onWalletSignedIn(t.id,e)})),e.on("accountsChanged",(({accounts:e})=>r(this,void 0,void 0,(function*(){if(!e.length)return this.signOutWallet(t.id);this.store.dispatch({type:"ACCOUNTS_CHANGED",payload:{walletId:t.id,accounts:e}})})))),e.on("networkChanged",(({networkId:e})=>{this.emitter.emit("networkChanged",{walletId:t.id,networkId:e})})),e}decorateWallet(t){const e=t.signIn,n=t.signOut;return t.signIn=n=>r(this,void 0,void 0,(function*(){const r=yield e(n),{contractId:o,methodNames:i=[]}=n;return yield this.onWalletSignedIn(t.id,{accounts:r,contractId:o,methodNames:i}),r})),t.signOut=()=>r(this,void 0,void 0,(function*(){yield n(),this.onWalletSignedOut(t.id)})),t}setupInstance(t){return r(this,void 0,void 0,(function*(){if(!t.metadata.available){const e="injected"===t.type?"not installed":"not available";throw Error(`${t.metadata.name} is ${e}`)}const e=Object.assign({id:t.id,type:t.type,metadata:t.metadata},yield t.init({id:t.id,type:t.type,metadata:t.metadata,options:this.options,store:this.store.toReadOnly(),provider:this.provider,emitter:this.setupWalletEmitter(t),logger:new tl(t.id),storage:new i(this.storage,[Wl,t.id])}));return this.decorateWallet(e)}))}getModule(t){return this.modules.find((e=>e.id===t))}getWallet(t){return r(this,void 0,void 0,(function*(){const e=this.getModule(t);return e?yield e.wallet():null}))}setup(){return r(this,void 0,void 0,(function*(){const t=[];for(let e=0;e<this.factories.length;e+=1){const n=yield this.factories[e]({options:this.options}).catch((t=>(el.log("Failed to setup module"),el.error(t),null)));if(n){if(t.some((t=>t.id===n.id)))throw new Error("Duplicate module id detected: "+n.id);t.push({id:n.id,type:n.type,metadata:n.metadata,wallet:()=>r(this,void 0,void 0,(function*(){let t=this.instances[n.id];return t||(t=yield this.setupInstance(n),this.instances[n.id]=t,t)}))})}}this.modules=t;const{accounts:e,contract:n,selectedWalletId:o}=yield this.resolveStorageState();this.store.dispatch({type:"SETUP_WALLET_MODULES",payload:{modules:t,accounts:e,contract:n,selectedWalletId:o}})}))}}const Dl=t=>"string"==typeof t?(t=>{switch(t){case"mainnet":return{networkId:t,nodeUrl:"https://rpc.mainnet.near.org",helperUrl:"https://helper.mainnet.near.org",explorerUrl:"https://explorer.near.org",indexerUrl:"https://api.kitwallet.app"};case"testnet":return{networkId:t,nodeUrl:"https://rpc.testnet.near.org",helperUrl:"https://helper.testnet.near.org",explorerUrl:"https://explorer.testnet.near.org",indexerUrl:"https://testnet-api.kitwallet.app"};default:throw Error(`Failed to find config for: '${t}'`)}})(t):t,Ul=(t,e)=>{switch(el.log("Store Action",e),e.type){case"SETUP_WALLET_MODULES":{const{modules:n,accounts:r,contract:o,selectedWalletId:i}=e.payload,s=r.map(((t,e)=>Object.assign(Object.assign({},t),{active:0===e})));return Object.assign(Object.assign({},t),{modules:n,accounts:s,contract:o,selectedWalletId:i})}case"WALLET_CONNECTED":{const{walletId:n,contract:r,accounts:o}=e.payload;if(!o.length)return t;const i=t.accounts.findIndex((t=>t.active)),s=o.map(((t,e)=>Object.assign(Object.assign({},t),{active:e===(i>-1?i:0)})));return Object.assign(Object.assign({},t),{contract:r,accounts:s,selectedWalletId:n})}case"WALLET_DISCONNECTED":{const{walletId:n}=e.payload;return n!==t.selectedWalletId?t:Object.assign(Object.assign({},t),{contract:null,accounts:[],selectedWalletId:null})}case"ACCOUNTS_CHANGED":{const{walletId:n,accounts:r}=e.payload;if(n!==t.selectedWalletId)return t;const o=t.accounts.find((t=>t.active)),i=!r.some((t=>t.accountId===(null==o?void 0:o.accountId))),s=r.map(((t,e)=>Object.assign(Object.assign({},t),{active:i?0===e:t.accountId===(null==o?void 0:o.accountId)})));return Object.assign(Object.assign({},t),{accounts:s})}case"SET_ACTIVE_ACCOUNT":{const{accountId:n}=e.payload,r=t.accounts.map((t=>Object.assign(Object.assign({},t),{active:t.accountId===n})));return Object.assign(Object.assign({},t),{accounts:r})}default:return t}};let Gl=null;const Vl=t=>new Promise((e=>setTimeout(e,t))),ql=(t,e,n)=>r(void 0,void 0,void 0,(function*(){const r=t();if(r)return r;if(!n)throw new Error("Exceeded timeout");return Vl(e).then((()=>ql(t,e,n-1)))}));t.getActiveAccount=t=>t.accounts.find((t=>t.active))||null,t.setupWalletSelector=t=>r(void 0,void 0,void 0,(function*(){const{options:e,storage:s}=(t=>({options:{network:Dl(t.network),debug:t.debug||!1},storage:t.storage||new ca}))(t);tl.debug=e.debug;const c=new Cl,a=yield(t=>r(void 0,void 0,void 0,(function*(){const e=new i(t,Wl),o={modules:[],accounts:[],contract:yield e.getItem(kl),selectedWalletId:yield e.getItem(Ml)},s=new n.BehaviorSubject(o),c=new n.Subject;c.pipe(n.scan(Ul,o)).subscribe(s);const a=(t,n,o,i)=>r(void 0,void 0,void 0,(function*(){n[i]!==t[i]&&(n[i]?yield e.setItem(o,n[i]):yield e.removeItem(o))}));let u=s.getValue();return s.subscribe((t=>{a(u,t,Ml,"selectedWalletId"),a(u,t,kl,"contract"),u=t})),{observable:s,getState:()=>s.getValue(),dispatch:t=>c.next(t),toReadOnly:()=>({getState:()=>s.getValue(),observable:s.asObservable()})}})))(s),u=new Fl({factories:t.modules,storage:s,options:e,store:a,emitter:c,provider:new o(e.network.nodeUrl)});return yield u.setup(),Gl||(Gl={options:e,store:a.toReadOnly(),wallet:t=>r(void 0,void 0,void 0,(function*(){const{selectedWalletId:e}=a.getState(),n=yield u.getWallet(t||e);if(!n){if(t)throw new Error("Invalid wallet id");throw new Error("No wallet selected")}return n})),setActiveAccount:t=>{const{accounts:e}=a.getState();if(!e.some((e=>e.accountId===t)))throw new Error("Invalid account id");a.dispatch({type:"SET_ACTIVE_ACCOUNT",payload:{accountId:t}})},isSignedIn(){const{accounts:t}=a.getState();return Boolean(t.length)},on:(t,e)=>c.on(t,e),off:(t,e)=>{c.off(t,e)}}),Gl})),t.waitFor=(t,e={})=>r(void 0,void 0,void 0,(function*(){const{timeout:n=200,interval:r=50}=e;return Promise.race([Vl(n).then((()=>{throw new Error("Exceeded timeout")})),ql(t,r,Math.floor(n/r))])})),Object.defineProperty(t,"__esModule",{value:!0})}));